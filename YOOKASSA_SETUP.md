# Настройка интеграции с ЮKassa

## 1. Установка зависимостей

В папке `backend` выполните:

```bash
npm install @appigram/yookassa-node@^1.1.11
```

## 2. Настройка переменных окружения

Создайте файл `.env` в папке `backend` со следующими переменными:

```env
# YooKassa
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret_key

# Frontend URL
FRONTEND_URL=https://svadba2.onrender.com
```

### Получение данных для ЮKassa:

1. Зарегистрируйтесь в [ЮKassa](https://yookassa.ru/)
2. Создайте магазин в личном кабинете
3. Получите Shop ID и Secret Key в разделе "Настройки" → "API"

## 3. Настройка webhook'ов

В личном кабинете ЮKassa добавьте webhook URL:
```
https://svadba2.onrender.com/webhook/yookassa
```

## 4. Тестирование

### Тестовые карты:
- **Успешная оплата**: 1111 1111 1111 1026
- **Недостаточно средств**: 1111 1111 1111 1040
- **Отклонена банком**: 1111 1111 1111 1051

### Тестовые данные:
- Срок действия: любой будущий
- CVV: любой 3-значный код
- Имя владельца: любое

## 5. Структура платежа

Система автоматически создает:
- Заказ в базе данных
- Платеж в ЮKassa на сумму предоплаты (30%)
- Возврат на страницу успешной оплаты

## 6. Безопасность

- Все платежи проходят через защищенное соединение HTTPS
- Используется idempotence key для предотвращения дублирования
- Webhook проверяет статус платежа и обновляет заказ

## 7. Мониторинг

В админ-панели доступна информация о:
- Статусе заказов
- Суммах предоплат
- Информации о клиентах

## 8. Поддержка

При возникновении проблем проверьте:
- Логи сервера
- Статус webhook'ов в личном кабинете ЮKassa
- Правильность переменных окружения
