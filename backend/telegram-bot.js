const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();
const { getLead, deleteLead } = require('./leadStore');

// –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
const token = process.env.TELEGRAM_BOT_TOKEN;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
if (!token) {
  console.error('‚ùå TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!');
  console.error('–î–æ–±–∞–≤—å—Ç–µ TELEGRAM_BOT_TOKEN –≤ .env —Ñ–∞–π–ª –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Render');
  process.exit(1);
}

console.log('‚úÖ TELEGRAM_BOT_TOKEN –Ω–∞–π–¥–µ–Ω');
const bot = new TelegramBot(token, { polling: false }); // –í –ø—Ä–æ–¥–µ —Ä–∞–±–æ—Ç–∞–µ–º —á–µ—Ä–µ–∑ webhook

// –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const userStates = new Map();

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —á–∞—Ç—É –Ω–∞ —Å–∞–π—Ç–µ)
const quickQuestions = {
  '–í–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ‚Äî –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è': {
    answer: `**–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ:** 
**–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**  
–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —Å–≤–æ–∏—Ö –≥–æ—Å—Ç–µ–π —Ñ–µ–µ—Ä–∏—á–Ω–æ –∏ —Å–æ–∑–¥–∞–π—Ç–µ WOW-—ç—Ñ—Ñ–µ–∫—Ç –µ—â–µ –≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ!

–ù–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –≤–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —É–¥–∏–≤—è—Ç –∏ –ø—Ä–æ–∏–∑–≤–µ–¥—É—Ç WOW
‚Äì —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –≤–∞—à–∏—Ö –≥–æ—Å—Ç–µ–π. –û–Ω–∏ –∑–∞–ø–æ–º–Ω—è—Ç –≤–∞—à—É —Å–≤–∞–¥—å–±—É –µ—â–µ —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∏ —Ç–æ—á–Ω–æ–∑–∞—Ö–æ—Ç—è—Ç –Ω–∞ –Ω–µ–µ –ø—Ä–∏–π—Ç–∏.

–í–æ–∑–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ, –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö,–±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è, –∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ. –ê –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –∏–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
–≥–æ—Å—Ç—è –æ—Ç–¥–µ–ª—å–Ω–æ.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  },
  '–í–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ‚Äî —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏': {
    answer: `**–°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ä–æ–∫–∏:** 
**–ù–µ–∏–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ:** 
–ó–∞–º–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ –±–µ–∑ –∏–º–µ–Ω–∏ ‚Äì 3000 —Ä./ —Å—Ä–æ–∫ ‚Äì1 –¥–µ–Ω—å
 **–ò–º–µ–Ω–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ:**  
–° –æ–±—Ä–∞—â–µ–Ω–∏–µ–º –∏ —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –∏–º–µ–Ω–∏ –≤–Ω–∞—á–∞–ª–µ: 
–¥–æ 25 –∏–º–µ–Ω ‚Äì 4000 —Ä, 
–¥–æ 50 –∏–º–µ–Ω ‚Äì 5000 —Ä, 
 51-100 –∏–º–µ–Ω ‚Äì 7000 —Ä 
–°—Ä–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è 2-4 –¥–Ω—è, –≤–æ–∑–º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  },
  '–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ?': {
    answer: `–û–ø–∏—à–∏—Ç–µ –∫–∞–∫ –≤–∏–¥–∏—Ç–µ –∏ –º—ã —Å–∫–∞–∂–µ–º –≤–æ–∑–º–æ–∂–Ω–æ –ª–∏ —ç—Ç–æ.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  },
  '–°–≤–∞–¥–µ–±–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è': {
    answer: `**–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:** 

1. –°–Ω–∞—á–∞–ª–∞ –¥–æ –∑–∞–∫–∞–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è —Å —ç–∫—Ä–∞–Ω–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏. –î–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥–æ–π–¥—É—Ç –Ω–µ –≤—Å–µ —ç–∫—Ä–∞–Ω—ã, –∞ —Ç–æ–ª—å–∫–æ —Å
–ø—Ä–æ–ø–æ—Ä—Ü–∏—è–º–∏ 16:9 –∏ 16:10. –£—Ç–æ—á–Ω–∏—Ç–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞ —ç–∫—Ä–∞–Ω–∞, –∞ —Ç–∞–∫–∂–µ –µ–≥–æ—Ä–∞–∑–º–µ—Ä, –∏ —Å–æ–æ–±—â–∏—Ç–µ –Ω–∞–º –ø–µ—Ä–µ–¥ –∑–∞–∫–∞–∑–æ–º. –ß—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –ø—Ä–∏–º–µ—Ä–Ω–æ –±—É–¥–µ—Ç
–≤—ã–≥–ª—è–¥–µ—Ç—å –≤–∞—à–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ —ç—Ç–æ–º —ç–∫—Ä–∞–Ω–µ ‚Äì –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –Ω–∞—à –æ–±—Ä–∞–∑–µ—Ü –∏–ø–æ–ø—Ä–æ—Å–∏—Ç—å –µ–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –Ω—ë–º. 

2. –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ –∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ –∞–ª—å–±–æ–º–∞. –í–Ω–∞—à–µ–º –≤–∏–¥–µ–æ-–æ–±—Ä–∞–∑—Ü–µ 16 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏ 4 —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞. –í–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤
–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã (–∫–∞–∂–¥—ã–π —Ä–∞–∑–≤–æ—Ä–æ—Ç ‚Äì 4 —Ñ–æ—Ç–æ). –¶–µ–Ω–∞ –∫–∞–∂–¥–æ–≥–æ–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ + 500 - 1000 —Ä—É–±. –¢–∞–∫–∂–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç
–æ–±—ä–µ–º–∞ —Ç–µ–∫—Å—Ç–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ —Ñ–æ—Ç–æ. –í —à–∞–±–ª–æ–Ω–µ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫ —Ñ–æ—Ç–æ –Ω–µ –±–æ–ª—å—à–µ 300—Å–∏–º–≤–æ–ª–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–∞–∫–∂–µ, –Ω–µ –¥–µ–ª–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É —Ñ–æ—Ç–æ –±–æ–ª—å—à–µ.
–≠—Ç–æ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∑–∞—Ç—è–Ω—É—Ç–æ –∏ –∑–∞–Ω—É–¥–Ω–æ.. –¢–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω–æ–µ. –ß—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ(–Ω–∞–ø—Ä–∏–º–µ—Ä –±–∏–æ–≥—Ä–∞—Ñ–∏—é –º–∞–º—ã) –±–æ–ª—å—à–µ - –ª—É—á—à–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ –∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã.. –ë—É–¥–µ—Ç
–≤—ã–≥–ª—è–¥–µ—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ! 
3. –í —à–∞–±–ª–æ–Ω–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –≤—Å–µ —Ñ–æ—Ç–æ ¬´–æ–∂–∏–≤–ª–µ–Ω—ã¬ª. –ú–æ–∂–Ω–æ –∑–∞–∫–∞–∑–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∏–±–µ–∑ –æ–∂–∏–≤–ª–µ–Ω–∏—è. –û–∂–∏–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏—Ç + 2000 (16 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π). –ò –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ —Å—Ä–æ–∫—É
–∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è 1-2 –¥–Ω—è. 
4. –ü–æ–∫–∞ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ —Ç–æ–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º–≤–∞—Ä–∏–∞–Ω—Ç–µ. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ –∞—É–¥–∏–æ-–ø–æ–¥–ª–æ–∂–∫–∏ –Ω–∞ –≤—ã–±–æ—Ä. 
5. –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ—Å—å —Å —ç–∫—Ä–∞–Ω–æ–º, –¥–ª—è –∑–∞–∫–∞–∑–∞ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
¬´–∑–∞–∫–∞–∑–∞—Ç—å¬ª, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—É –≤ —Ä–∞–∑–º–µ—Ä–µ 30% (–≤ —Å–ª—É—á–∞–µ –æ—Ç–∫–∞–∑–∞ –æ—Ç –∑–∞–∫–∞–∑–∞–ø—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è). –ü–æ—Å–ª–µ —á–µ–≥–æ –≤–∞–º –±—É–¥–µ—Ç –≤—ã—Å–ª–∞–Ω–∞ —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
—Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç–∞. –û—á–µ–Ω—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥–æ–π–¥–∏—Ç–µ –∫ –ø–æ–¥–±–æ—Ä—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π. –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–∏–ª—é–±–∏–º—ã–µ —Ñ–æ—Ç–æ –∏–∑ –≤–∞—à–µ–≥–æ –¥–µ—Ç—Å—Ç–≤–∞, —à–∫–æ–ª—å–Ω—ã—Ö –ª–µ—Ç, —Å—Ç—É–¥–µ–Ω—á–µ—Å—Ç–≤–∞ –∏ –∫–æ–Ω–µ—á–Ω–æ –∂–µ –≤–∞—à–∏
–ª—É—á—à–∏–µ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ —Ñ–æ—Ç–æ. –ø–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –º—ã –≤—ã—à–ª–µ–º –≤–∞–º —Ñ–æ—Ä–º—É –¥–ª—è–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏—è. –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç—É–¥–∞ –≤—Å–µ —Ñ–æ—Ç–æ –∏ —Ç–µ–∫—Å—Ç. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è
–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –º—ã –ø—Ä–∏—Å—Ç—É–ø–∞–µ–º –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É. –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –º—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –≤–∞–º–≤–∏–¥–µ–æ –Ω–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ. –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 –ø—Ä–∞–≤–∫–∞ –≤ —Ç–µ–∫—Å—Ç–µ. –¢–∞–∫ —á—Ç–æ —Ñ–æ—Ç–æ
–ø–æ–¥–±–∏—Ä–∞–π—Ç–µ –æ—á–µ–Ω—å –æ–±–¥—É–º–∞–Ω–Ω–æ. –ü–æ—Å–ª–µ –ø—Ä–∞–≤–∫–∏ –∏ –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è –≤–∞—à–µ–π–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –≤–∞–º –Ω—É–∂–Ω–æ –¥–æ–ø–ª–∞—Ç–∏—Ç—å 70 % —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –º—ã –ø—Ä–∏—à–ª–µ–º –≤–∞–º –≤–∞—à—É —Å–≤–∞–¥–µ–±–Ω—É—é
–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –Ω–∞ –ø–æ—á—Ç—É.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  },
  '–°–≤–∞–¥–µ–±–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è ‚Äî —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏': {
    answer: `**–°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ä–æ–∫–∏:** 
**–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –±–µ–∑ –æ–∂–∏–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ** (—Ñ–æ—Ç–æ –±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è) –∏  –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫ –∫–∞–∂–¥–æ–º—É —Ñ–æ—Ç–æ –Ω–∞ 300 —Å–∏–º–≤–æ–ª–æ–≤ (–∫–∞–∫–≤ —à–∞–±–ª–æ–Ω–µ):
4 —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ (16 —Ñ–æ—Ç–æ, 6:23 –º–∏–Ω) ‚Äì 10000—Ä / —Å—Ä–æ–∫ 3-4 –¥–Ω—è
5 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (20 —Ñ–æ—Ç–æ, 8 –º–∏–Ω) ‚Äì 10500/—Å—Ä–æ–∫ 3-4  –¥–Ω—è 
6 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (24 —Ñ–æ—Ç–æ, 10 –º–∏–Ω) ‚Äì 11000 / —Å—Ä–æ–∫ 4-5 –¥–Ω–µ–π 
7 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (28 —Ñ–æ—Ç–æ, 12 –º–∏–Ω) ‚Äì 11500 / —Å—Ä–æ–∫ 4-5 –¥–Ω–µ–π
**–¶–µ–Ω—ã —Å –æ–∂–∏–≤–ª–µ–Ω–∏–µ–º —Ñ–æ—Ç–æ** –∏ —Ç–µ–∫—Å—Ç–æ–º –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É —Ñ–æ—Ç–æ 300
—Å–∏–º–≤–æ–ª–æ–≤ (–∫–∞–∫ —à–∞–±–ª–æ–Ω):
 4 —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ (16 —Ñ–æ—Ç–æ,6:23 –º–∏–Ω) ‚Äì 12000—Ä /—Å—Ä–æ–∫ 4-5 –¥–Ω–µ–π
5 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (20 —Ñ–æ—Ç–æ, 8 –º–∏–Ω) ‚Äì 1300/—Å—Ä–æ–∫ 4-5  –¥–Ω–µ–π 
6 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (24 —Ñ–æ—Ç–æ, 10 –º–∏–Ω) ‚Äì 13500 / —Å—Ä–æ–∫ 5-6 –¥–Ω–µ–π 
7 —Ä–∞–∑–≤–æ—Ä–æ—Ç–æ–≤ (28 —Ñ–æ—Ç–æ, 12 –º–∏–Ω) ‚Äì 14000 / —Å—Ä–æ–∫ 5-6 –¥–Ω–µ–π
–ó–∞ –∫–∞–∂–¥—ã–µ 300+ —Å–∏–º–≤–æ–ª–æ–≤ –∫ —Ç–µ–∫—Å—Ç—É –¥–ª—è —Ñ–æ—Ç–æ - 200—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ 300 —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ–¥ –∫–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å—Å—è–∑–∞–Ω—É–¥–Ω–æ. –ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è –±–æ–ª—å—à–µ –æ–ø–∏—Å–∞–Ω–∏—è ‚Äî –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ª—É—á—à–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç—ã,
–±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å—Å—è –Ω–∞–º–Ω–æ–≥–æ –ª—É—á—à–µ)
–°—Ä–æ–∫–∏ –º–æ–≥—É—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã. –£–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è  –ø–æ
—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—é —Å –∑–∞–∫–∞–∑—á–∏–∫–æ–º.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  },
  '–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é?': {
    answer: `–í –ø—Ä–∏–Ω—Ü–∏–ø–µ –º–æ–∂–Ω–æ. –û–ø–∏—à–∏—Ç–µ –∫–∞–∫ –≤—ã –µ–µ –≤–∏–¥–∏—Ç–µ. –ò –º—ã —Å–∫–∞–∂–µ–º —Å–º–æ–∂–µ–º –ª–∏ –º—ã —ç—Ç–æ.`,
    quickActions: ['–ó–∞–∫–∞–∑–∞—Ç—å', '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è']
  }
};

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
const mainMenu = {
  reply_markup: {
    inline_keyboard: [
      [{ text: 'üé¨ –í–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è', callback_data: 'category_invitations' }],
      [{ text: 'üíí –°–≤–∞–¥–µ–±–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è', callback_data: 'category_presentations' }],
      [{ text: 'üí¨ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º', callback_data: 'consultation' }]
    ]
  }
};

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
async function showMainMenu(chatId, messageId) {
  const text = '–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –≤–æ–ø—Ä–æ—Å:';
  try {
    await bot.editMessageText(text, {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: mainMenu.reply_markup,
      parse_mode: 'Markdown'
    });
  } catch (err) {
    // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤–æ–µ –ø–æ—Å–ª–µ /start), –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–æ–≤–æ–µ
    await bot.sendMessage(chatId, text, { reply_markup: mainMenu.reply_markup });
  }
}

function buildCategoryMenu(category) {
  if (category === 'invitations') {
    return {
      text: '–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –≤–æ–ø—Ä–æ—Å –æ –≤–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è—Ö:',
      markup: {
        inline_keyboard: [
          [{ text: 'üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', callback_data: 'question_invitations_info' }],
          [{ text: 'üí∞ –¶–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏', callback_data: 'question_invitations_price' }],
          [{ text: '‚ùì –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑', callback_data: 'question_invitations_custom' }],
          [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', callback_data: 'back_to_main' }]
        ]
      }
    };
  }
  return {
    text: '–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –≤–æ–ø—Ä–æ—Å –æ —Å–≤–∞–¥–µ–±–Ω–æ–π –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏:',
    markup: {
      inline_keyboard: [
        [{ text: 'üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', callback_data: 'question_presentations_info' }],
        [{ text: 'üí∞ –¶–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏', callback_data: 'question_presentations_price' }],
        [{ text: '‚ùì –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑', callback_data: 'question_presentations_custom' }],
        [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', callback_data: 'back_to_main' }]
      ]
    }
  };
}

async function showCategoryMenu(chatId, messageId, category) {
  const { text, markup } = buildCategoryMenu(category);
  try {
    await bot.editMessageText(text, {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: markup,
      parse_mode: 'Markdown'
    });
  } catch (err) {
    await bot.sendMessage(chatId, text, { reply_markup: markup });
  }
}

const questionKeyToTitle = {
  'invitations_info': '–í–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ‚Äî –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
  'invitations_price': '–í–∏–¥–µ–æ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ‚Äî —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏',
  'invitations_custom': '–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ?',
  'presentations_info': '–°–≤–∞–¥–µ–±–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
  'presentations_price': '–°–≤–∞–¥–µ–±–Ω–∞—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è ‚Äî —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏',
  'presentations_custom': '–ú–æ–∂–Ω–æ –ª–∏ –∑–∞–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é?'
};

async function showQuestion(chatId, messageId, category, questionKey) {
  const title = questionKeyToTitle[`${category}_${questionKey}`];
  const questionData = quickQuestions[title];
  if (!questionData) return;

  const quickActionsRow = [
    { text: 'üõí –ó–∞–∫–∞–∑–∞—Ç—å', callback_data: 'order' },
    { text: 'üí¨ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è', callback_data: 'consultation' }
  ];

  const keyboard = {
    inline_keyboard: [
      quickActionsRow,
      [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ –≤–æ–ø—Ä–æ—Å–∞–º', callback_data: `back_to_category_${category}` }],
      [{ text: 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', callback_data: 'back_to_main' }]
    ]
  };

  try {
    await bot.editMessageText(questionData.answer, {
      chat_id: chatId,
      message_id: messageId,
      reply_markup: keyboard,
      parse_mode: 'Markdown'
    });
  } catch (err) {
    await bot.sendMessage(chatId, questionData.answer, { reply_markup: keyboard, parse_mode: 'Markdown' });
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.onText(/\/start(?:\s+(.*))?/, async (msg, match) => {
  console.log('üéØ –ü–æ–ª—É—á–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /start –æ—Ç:', msg.from.first_name, 'ID:', msg.chat.id);
  
  const chatId = msg.chat.id;
  const userName = msg.from.first_name;
  const usernameHandle = msg.from.username ? '@' + msg.from.username : '(–±–µ–∑ username)';
  const startPayload = (match && match[1]) ? String(match[1]) : '';
  
  userStates.set(chatId, { state: 'main' });
  
  // –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ lead_<id> ‚Äî —É–≤–µ–¥–æ–º–ª—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å username
  try {
    if (startPayload && startPayload.startsWith('lead_')) {
      const leadId = startPayload.replace('lead_', '');
      const lead = getLead(leadId);
      if (lead) {
        const adminId = process.env.ADMIN_TELEGRAM_ID;
        if (adminId) {
          const lines = [
            `üì© –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–ª –±–æ—Ç–∞ –ø–æ –∑–∞—è–≤–∫–µ #${leadId}`,
            `–ü—Ä–æ—Ñ–∏–ª—å: ${usernameHandle} (id ${msg.from.id})`,
            `–ò–º—è: ${lead.name}`,
            `–°—Ä–æ–∫/–¥–∞—Ç–∞: ${lead.term}`,
            `–ë—é–¥–∂–µ—Ç: ${lead.budget}`,
            `–≠–∫—Ä–∞–Ω: ${lead.screen}`,
            `–ü—Ä–æ–¥—É–∫—Ç: ${lead.product}`,
            `–ò—Å—Ç–æ—á–Ω–∏–∫: ${lead.source}`
          ];
          await bot.sendMessage(adminId, lines.join('\n'));
        }
        deleteLead(leadId);
      }
    }
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞ –æ lead —Å—Ç–∞—Ä—Ç:', e);
  }

  const welcomeMessage = `üëã –ü—Ä–∏–≤–µ—Ç, ${userName}!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç —Å–≤–∞–¥–µ–±–Ω—ã—Ö –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π! üéâ

–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –¥–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏.

–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å –≤–æ–ø—Ä–æ—Å:`;
  
  bot.sendMessage(chatId, welcomeMessage, mainMenu)
    .then(() => console.log('‚úÖ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'))
    .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:', err));
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∑–∞–ø—Ä–æ—Å–æ–≤
bot.on('callback_query', async (query) => {
  console.log('üîò –ü–æ–ª—É—á–µ–Ω callback –æ—Ç:', query.from.first_name, '–î–∞–Ω–Ω—ã–µ:', query.data);
  
  const chatId = query.message.chat.id;
  const data = query.data;
  const messageId = query.message.message_id;
  const state = userStates.get(chatId) || {};
  const currentCategory = state.category;
  
  // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ callback
  await bot.answerCallbackQuery(query.id);
  
  if (data.startsWith('category_')) {
    const category = data.replace('category_', '');
    userStates.set(chatId, { state: 'category', category });
    await showCategoryMenu(chatId, messageId, category);
  } else if (data.startsWith('question_')) {
    const parts = data.split('_'); // ['question', '<category>', '<key>']
    const category = parts[1];
    const key = parts[2];
    await showQuestion(chatId, messageId, category, key);
  } else if (data === 'consultation') {
    const text = `üí¨ –î–ª—è —Å–≤—è–∑–∏ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º:\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä ‚Äî –æ—Ç–≤–µ—Ç–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ.`;
    const backCb = currentCategory ? `back_to_category_${currentCategory}` : 'back_to_main';
    const keyboard = {
      inline_keyboard: [
        [
          { text: 'üì≤ –û—Ç–∫—Ä—ã—Ç—å Telegram', url: 'https://t.me/feiero' },
          { text: 'üì≤ –û—Ç–∫—Ä—ã—Ç—å WhatsApp', url: 'https://wa.me/79004511777' }
        ],
        [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: backCb }]
      ]
    };
    try {
      await bot.editMessageText(text, { chat_id: chatId, message_id: messageId, reply_markup: keyboard });
    } catch (e) {
      await bot.sendMessage(chatId, text, { reply_markup: keyboard });
    }
  } else if (data === 'order') {
    const text = `üõí –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç –∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É:`;
    const backCb = currentCategory ? `back_to_category_${currentCategory}` : 'back_to_main';
    const keyboard = {
      inline_keyboard: [
        [ { text: 'üåê –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ', url: 'https://xn--e1aalvju.xn--p1ai' } ],
        [{ text: '‚¨ÖÔ∏è –ù–∞–∑–∞–¥', callback_data: backCb }]
      ]
    };
    try {
      await bot.editMessageText(text, { chat_id: chatId, message_id: messageId, reply_markup: keyboard });
    } catch (e) {
      await bot.sendMessage(chatId, text, { reply_markup: keyboard });
    }
  } else if (data.startsWith('back_to_category_')) {
    const category = data.replace('back_to_category_', '');
    userStates.set(chatId, { state: 'category', category });
    await showCategoryMenu(chatId, messageId, category);
  } else if (data === 'back_to_main') {
    userStates.set(chatId, { state: 'main' });
    await showMainMenu(chatId, messageId);
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('message', (msg) => {
  console.log('üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç:', msg.from.first_name, '–¢–µ–∫—Å—Ç:', msg.text);
  
  const chatId = msg.chat.id;
  
  // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –∫–æ–º–∞–Ω–¥–∞ /start, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–µ–Ω—é
  if (!msg.text.startsWith('/')) {
    const helpMessage = `–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é.`;
    
    const helpKeyboard = {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é', callback_data: 'back_to_main' }]
        ]
      }
    };
    
    bot.sendMessage(chatId, helpMessage, helpKeyboard)
      .then(() => console.log('‚úÖ –ü–æ–º–æ—â—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'))
      .catch(err => console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–º–æ—â–∏:', err));
  }
});



console.log('Telegram bot started...');

function resolveWebhookBaseUrl() {
  const base = (process.env.TELEGRAM_WEBHOOK_BASE
    || process.env.RENDER_EXTERNAL_URL
    || process.env.FRONTEND_URL
    || 'https://svadba2.onrender.com').trim();
  return base.endsWith('/') ? base.slice(0, -1) : base;
}

// –í–∫–ª—é—á–∞–µ–º webhook-—Ä–µ–∂–∏–º, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–∏–≤ —Å—Ç–∞—Ä—ã–π webhook
(async () => {
  try {
    await bot.deleteWebHook({ drop_pending_updates: true });
    console.log('Webhook —É–¥–∞–ª—ë–Ω (–µ—Å–ª–∏ –±—ã–ª).');
  } catch (e) {
    console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å webhook:', e.message);
  }

  try {
    const base = resolveWebhookBaseUrl();
    const webhookUrl = `${base}/webhook/telegram`;
    await bot.setWebHook(webhookUrl); // —É node-telegram-bot-api –º–µ—Ç–æ–¥ setWebHook
    console.log('Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞:', webhookUrl);
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ webhook:', e);
  }
  try {
    const me = await bot.getMe();
    console.log('–ë–æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ @' + me.username + ' (id ' + me.id + ')');
  } catch (e) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç–∞ getMe:', e.message);
  }
  try {
    const info = await bot.getWebHookInfo();
    console.log('Webhook Info:', {
      url: info.url,
      has_custom_certificate: info.has_custom_certificate,
      pending_update_count: info.pending_update_count,
      last_error_message: info.last_error_message,
      last_error_date: info.last_error_date
    });
  } catch (e) {
    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å getWebHookInfo:', e.message);
  }
})();

module.exports = bot;
